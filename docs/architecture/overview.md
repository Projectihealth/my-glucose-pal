# ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

## ğŸ“ æ•´ä½“æ¶æ„

CGM Butler é‡‡ç”¨å¾®æœåŠ¡æ¶æ„,ä¸»è¦åŒ…å«ä»¥ä¸‹ç»„ä»¶:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Frontend (React)                        â”‚
â”‚                     http://localhost:5173                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                            â”‚
                 â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend (Flask)          â”‚  â”‚   Minerva (FastAPI)            â”‚
â”‚   Port: 5000               â”‚  â”‚   Port: 8000                   â”‚
â”‚                            â”‚  â”‚                                â”‚
â”‚   - User API               â”‚  â”‚   - Voice Chat (Retell)        â”‚
â”‚   - CGM Data API           â”‚  â”‚   - Call Management            â”‚
â”‚   - Olivia Chat (GPT/Tavus)â”‚  â”‚   - Transcript Processing      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                               â”‚
             â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚      â”‚
             â–¼      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Shared Database       â”‚
    â”‚   (SQLite)              â”‚
    â”‚                         â”‚
    â”‚   - conversations       â”‚
    â”‚   - user_memories       â”‚
    â”‚   - user_todos          â”‚
    â”‚   - cgm_readings        â”‚
    â”‚   - users               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—‚ï¸ ç›®å½•ç»“æ„

```
my-glucose-pal/
â”œâ”€â”€ apps/                      â† åº”ç”¨å±‚
â”‚   â”œâ”€â”€ frontend/             â† React å‰ç«¯
â”‚   â”œâ”€â”€ backend/              â† Flask åç«¯
â”‚   â””â”€â”€ minerva/              â† FastAPI è¯­éŸ³æœåŠ¡
â”œâ”€â”€ shared/                    â† å…±äº«å±‚
â”‚   â””â”€â”€ database/             â† æ•°æ®åº“è®¿é—®å±‚
â”œâ”€â”€ config/                    â† é…ç½®ç®¡ç†
â”œâ”€â”€ storage/                   â† è¿è¡Œæ—¶æ•°æ®
â”‚   â”œâ”€â”€ databases/            â† æ•°æ®åº“æ–‡ä»¶
â”‚   â”œâ”€â”€ logs/                 â† æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ uploads/              â† ä¸Šä¼ æ–‡ä»¶
â”œâ”€â”€ docs/                      â† æ–‡æ¡£
â””â”€â”€ cgm_butler/               â† é—ç•™ä»£ç  (å¾…è¿ç§»)
```

## ğŸ”„ æ•°æ®æµ

### 1. æ–‡æœ¬å¯¹è¯ (GPT Chat)

```
Frontend â†’ Backend (GPT Chat API) â†’ OpenAI GPT-4o â†’ Database
                                                    â†“
                                              Memory Service
                                                    â†“
                                         user_memories + user_todos
```

### 2. è§†é¢‘å¯¹è¯ (Tavus)

```
Frontend â†’ Backend (Tavus API) â†’ Tavus Service â†’ Database
                                                   â†“
                                             Memory Service
                                                   â†“
                                        user_memories + user_todos
```

### 3. è¯­éŸ³å¯¹è¯ (Retell)

```
Frontend â†’ Minerva (Retell API) â†’ Retell Service â†’ Database
                                                     â†“
                                               Memory Service
                                                     â†“
                                          user_memories + user_todos
```

## ğŸ”Œ å¤–éƒ¨æœåŠ¡é›†æˆ

### OpenAI GPT-4o
- **ç”¨é€”**: æ–‡æœ¬å¯¹è¯ã€æ‘˜è¦ç”Ÿæˆã€TODO æå–
- **ç«¯ç‚¹**: `https://api.openai.com/v1/chat/completions`

### Tavus
- **ç”¨é€”**: è§†é¢‘æ•°å­—äººå¯¹è¯
- **ç«¯ç‚¹**: `https://tavusapi.com/v2/`

### Retell AI
- **ç”¨é€”**: è¯­éŸ³å¯¹è¯
- **ç«¯ç‚¹**: `https://api.retellai.com/`

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨

1. **conversations** - æ‰€æœ‰å¯¹è¯è®°å½•
   - `conversation_type`: `gpt_chat` | `tavus_video` | `retell_voice`
   - ç»Ÿä¸€çš„ transcript å­—æ®µ

2. **user_memories** - çŸ­æœŸè®°å¿†
   - æ¯æ¬¡å¯¹è¯åç”Ÿæˆæ‘˜è¦
   - æœ€è¿‘ 7 å¤©çš„è®°å¿†ä½œä¸º context

3. **user_long_term_memory** - é•¿æœŸè®°å¿†
   - ç”¨æˆ·ä¹ æƒ¯ã€ç›®æ ‡ã€åå¥½
   - æ¯æ¬¡å¯¹è¯æ›´æ–°

4. **user_todos** - å¾…åŠäº‹é¡¹
   - ä»å¯¹è¯ä¸­æå–
   - æŒ‰å‘¨ç»„ç»‡

è¯¦è§ [æ•°æ®åº“ç»“æ„æ–‡æ¡£](./DATABASE_STRUCTURE.md)

## ğŸ” å®‰å…¨æ€§

### API Keys ç®¡ç†
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- `.env` æ–‡ä»¶ä¸æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡

### æ•°æ®å®‰å…¨
- æ•°æ®åº“æ–‡ä»¶åŠ å¯† (TODO)
- HTTPS ä¼ è¾“ (ç”Ÿäº§ç¯å¢ƒ)
- ç”¨æˆ·æ•°æ®éš”ç¦»

## ğŸ“Š æ€§èƒ½è€ƒè™‘

### æ•°æ®åº“ä¼˜åŒ–
- ç´¢å¼•: `user_id`, `conversation_id`, `created_at`
- åˆ†é¡µæŸ¥è¯¢
- å®šæœŸæ¸…ç†æ—§æ•°æ®

### API æ€§èƒ½
- å¼‚æ­¥å¤„ç† (FastAPI)
- ç¼“å­˜æœºåˆ¶ (TODO)
- è¿æ¥æ±  (TODO)

## ğŸš€ æ‰©å±•æ€§

### æ°´å¹³æ‰©å±•
- Frontend: CDN + é™æ€æ‰˜ç®¡
- Backend: è´Ÿè½½å‡è¡¡ + å¤šå®ä¾‹
- Database: è¯»å†™åˆ†ç¦» (æœªæ¥)

### å‚ç›´æ‰©å±•
- å¢åŠ æœåŠ¡å™¨èµ„æº
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- ä»£ç æ€§èƒ½ä¼˜åŒ–

## ğŸ“ˆ æœªæ¥è§„åˆ’

1. **å¾®æœåŠ¡æ‹†åˆ†**
   - ç‹¬ç«‹çš„ Memory Service
   - ç‹¬ç«‹çš„ CGM Data Service

2. **æ•°æ®åº“è¿ç§»**
   - SQLite â†’ PostgreSQL (ç”Ÿäº§ç¯å¢ƒ)
   - æ”¯æŒæ›´å¤§è§„æ¨¡æ•°æ®

3. **å®æ—¶åŠŸèƒ½**
   - WebSocket æ”¯æŒ
   - å®æ—¶ CGM æ•°æ®æ¨é€

4. **AI å¢å¼º**
   - æ›´æ™ºèƒ½çš„ Memory ç®¡ç†
   - ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ

